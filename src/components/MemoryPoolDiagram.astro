---
const bytes = Array.from({ length: 32 }, (_, i) => i);

type AllocKey = "int" | "char" | "float" | "double" | "bool";

type Allocation = {
    key: AllocKey;
    label: string;
    start: number;
    length: number;
};

const allocations: Allocation[] = [
    { key: "int", label: "int (4 bytes)", start: 0, length: 4 },
    { key: "char", label: "char (1 byte)", start: 6, length: 1 },
    { key: "float", label: "float (4 bytes)", start: 8, length: 4 },
    { key: "double", label: "double (8 bytes)", start: 16, length: 8 },
    { key: "bool", label: "bool (1 byte)", start: 24, length: 1 },
];

function allocationForIndex(index: number): Allocation | undefined {
    return allocations.find(
        (a) => index >= a.start && index < a.start + a.length,
    );
}

const allocStyles: Record<AllocKey, string> = {
    int: "bg-sky-200 border-sky-500 text-sky-950 dark:bg-sky-900/50 dark:border-sky-400 dark:text-sky-100",
    char: "bg-emerald-200 border-emerald-500 text-emerald-950 dark:bg-emerald-900/50 dark:border-emerald-400 dark:text-emerald-100",
    float: "bg-rose-200 border-rose-500 text-rose-950 dark:bg-rose-900/50 dark:border-rose-400 dark:text-rose-100",
    double: "bg-amber-200 border-amber-500 text-amber-950 dark:bg-amber-900/50 dark:border-amber-400 dark:text-amber-100",
    bool: "bg-violet-200 border-violet-500 text-violet-950 dark:bg-violet-900/50 dark:border-violet-400 dark:text-violet-100",
};
---

<p>
    The illustration below shows a <em>byte-addressable</em> "pool" of memory (each
    box is 1 byte). Highlighted regions show how many 1-byte boxes a value of each
    type typically occupies:
</p>

<div class="my-4">
    <div class="text-sm text-center font-semibold mb-2">
        Memory pool (each box = 1 byte)
    </div>

    <div class="flex flex-col items-center md:items-start md:flex-row md:gap-6">
        <div
            class="grid grid-cols-8 gap-1 w-fit mx-auto md:mx-0 rounded-lg border border-gray-200 dark:border-gray-700 p-3 bg-white/60 dark:bg-gray-900/30"
        >
            {
                bytes.map((index) => {
                    const alloc = allocationForIndex(index);
                    const cellClass = alloc
                        ? allocStyles[alloc.key]
                        : "bg-gray-50 border-gray-300 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200";

                    return (
                        <div
                            class={`mt-0 flex items-center justify-center rounded border font-mono text-[11px] leading-none w-10 h-10 sm:w-11 sm:h-11 ${cellClass}`}
                            title={alloc ? alloc.label : "unused byte"}
                            aria-label={
                                alloc
                                    ? `${alloc.label}, byte ${index}`
                                    : `unused byte ${index}`
                            }
                        >
                            {String(index).padStart(2, "0")}
                        </div>
                    );
                })
            }
        </div>

        <div
            class="mt-3 justify-center flex flex-wrap md:flex-col gap-x-4 gap-y-2 text-sm"
        >
            {
                allocations.map((a) => (
                    <div class="mt-0 flex items-center gap-2">
                        <span
                            class={`inline-block h-3 w-3 rounded border ${allocStyles[a.key]}`}
                        />
                        <span class="font-mono">{a.label}</span>
                    </div>
                ))
            }
        </div>
    </div>
    <p>
        Each highlighted run is a contiguous block of 1-byte “boxes” (bytes)
        reserved for storing a single value. These boxes each have a unique
        address (00 to 31 in this example) that the computer uses to locate and
        access the value stored there.
    </p>
</div>
